 for (var i = 0; i < linecount; i++) {
                item = record.getLineItemValue('item', 'item', i + 1);
                clas = record.getLineItemValue('item', 'class_display', i + 1);
                //  var itemrec = nlapiLoadRecord('inventoryitem',item);   //  var clas = itemrec.getFieldText('class');
                if (!!clas && !!channel) {
                    nlapiLogExecution('DEBUG', "Channel & Class", channel + "-- " + clas);
                    loc = this.getLocationFromCustomRecord(channel, clas);
                    if (!!loc && !!loc.secondary) {
                        nlapiLogExecution('DEBUG', "Secondary location exist", JSON.stringify(loc));
                        var itemrec = nlapiLoadRecord('inventoryitem',item);
                        var totalloc = itemrec.getLineItemCount('locations');
                        nlapiLogExecution('DEBUG', "Total loc", totalloc);
                        for(var j =1 ; j <= totalloc; j++){
                            var currentloc = itemrec.getLineItemValue('locations','location',j);
                           // nlapiLogExecution('DEBUG', "current Loc",currentloc);
                            if(currentloc == loc.primary){
                                var qnty = itemrec.getLineItemValue('locations','quantityonhand',j);
                                nlapiLogExecution("DEBUG","Quantity on hand ", qnty);
                                if(!!qnty && qnty <= 0){
                                    nlapiLogExecution("DEBUG","Setting Sec loc ",loc.secondary);
                                    record.setLineItemValue('item', 'location', (i + 1), loc.secondary);
                                    break;
                                }
                                else{
                                    nlapiLogExecution("DEBUG","Setting primary loc ",loc.primary);
                                    record.setLineItemValue('item', 'location', (i + 1), loc.primary);
                                    break;
                                }
                            }
                        }
                       // record.setLineItemValue('item', 'location', (i + 1), loc);
                    }
                    else if(!!loc){
                        record.setLineItemValue('item', 'location', (i + 1), loc.primary);
                    }
                }
                else
                    nlapiLogExecution('DEBUG', "Enter Class for item " + item, "");
            }

